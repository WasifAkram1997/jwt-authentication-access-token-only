{"ast":null,"code":"var _jsxFileName = \"/Users/rumie/Documents/GitHub/jwt-authentication-access-token-only/React_frontend/frontend/src/context/AuthProvider.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useState, useEffect, useCallback } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE = \"http://localhost:8000\"; // FastAPI backend\nconst AuthContext = /*#__PURE__*/createContext(null);\nexport function useAuth() {\n  _s();\n  return useContext(AuthContext);\n}\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function AuthProvider({\n  children\n}) {\n  _s2();\n  const [accessToken, setAccessToken] = useState(null);\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  function parseJwt(token) {\n    try {\n      return JSON.parse(atob(token.split(\".\")[1]));\n    } catch {\n      return null;\n    }\n  }\n  const refresh = async () => {\n    const res = await fetch(`${API_BASE}/refresh`, {\n      method: \"POST\",\n      credentials: \"include\"\n    });\n    if (!res.ok) throw new Error(\"Refresh failed\");\n    const data = await res.json();\n    setAccessToken(data.access_token);\n    const payload = parseJwt(data.access_token);\n    setUser(payload !== null && payload !== void 0 && payload.sub ? {\n      username: payload.sub\n    } : null);\n    return data.access_token;\n  };\n  const login = async ({\n    username,\n    password\n  }) => {\n    const res = await fetch(`${API_BASE}/login`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      credentials: \"include\",\n      body: JSON.stringify({\n        username,\n        password\n      })\n    });\n    if (!res.ok) throw new Error(\"Login failed\");\n    const data = await res.json();\n    setAccessToken(data.access_token);\n    const payload = parseJwt(data.access_token);\n    setUser(payload !== null && payload !== void 0 && payload.sub ? {\n      username: payload.sub\n    } : null);\n  };\n  const signup = async ({\n    username,\n    password\n  }) => {\n    const res = await fetch(`${API_BASE}/signup`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        username,\n        password\n      })\n    });\n    if (!res.ok) throw new Error(\"Signup failed\");\n    return await res.json();\n  };\n  const logout = () => {\n    setAccessToken(null);\n    setUser(null);\n  };\n  const authFetch = async (url, options = {}, retry = true) => {\n    const headers = new Headers(options.headers || {});\n    if (accessToken) headers.set(\"Authorization\", `Bearer ${accessToken}`);\n    const res = await fetch(url, {\n      ...options,\n      headers,\n      credentials: \"include\"\n    });\n    if (res.status === 401 && retry) {\n      try {\n        const newToken = await refresh();\n        headers.set(\"Authorization\", `Bearer ${newToken}`);\n        return await fetch(url, {\n          ...options,\n          headers,\n          credentials: \"include\"\n        });\n      } catch {\n        logout();\n      }\n    }\n    return res;\n  };\n  useEffect(() => {\n    refresh().catch(() => {}).finally(() => setLoading(false));\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      login,\n      signup,\n      logout,\n      authFetch,\n      loading\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, this);\n}\n_s2(AuthProvider, \"bgJgOJB/swIVH3O3ewp2EUk6t9U=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","useCallback","jsxDEV","_jsxDEV","API_BASE","AuthContext","useAuth","_s","AuthProvider","children","_s2","accessToken","setAccessToken","user","setUser","loading","setLoading","parseJwt","token","JSON","parse","atob","split","refresh","res","fetch","method","credentials","ok","Error","data","json","access_token","payload","sub","username","login","password","headers","body","stringify","signup","logout","authFetch","url","options","retry","Headers","set","status","newToken","catch","finally","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/rumie/Documents/GitHub/jwt-authentication-access-token-only/React_frontend/frontend/src/context/AuthProvider.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect, useCallback } from \"react\";\n\nconst API_BASE = \"http://localhost:8000\"; // FastAPI backend\nconst AuthContext = createContext(null);\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\nexport function AuthProvider({ children }) {\n  const [accessToken, setAccessToken] = useState(null);\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  function parseJwt(token) {\n    try {\n      return JSON.parse(atob(token.split(\".\")[1]));\n    } catch {\n      return null;\n    }\n  }\n\n  const refresh = async () => {\n    const res = await fetch(`${API_BASE}/refresh`, {\n      method: \"POST\",\n      credentials: \"include\",\n    });\n    if (!res.ok) throw new Error(\"Refresh failed\");\n    const data = await res.json();\n    setAccessToken(data.access_token);\n    const payload = parseJwt(data.access_token);\n    setUser(payload?.sub ? { username: payload.sub } : null);\n    return data.access_token;\n  };\n\n  const login = async ({ username, password }) => {\n    const res = await fetch(`${API_BASE}/login`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      credentials: \"include\",\n      body: JSON.stringify({ username, password }),\n    });\n    if (!res.ok) throw new Error(\"Login failed\");\n    const data = await res.json();\n    setAccessToken(data.access_token);\n    const payload = parseJwt(data.access_token);\n    setUser(payload?.sub ? { username: payload.sub } : null);\n  };\n\n  const signup = async ({ username, password }) => {\n    const res = await fetch(`${API_BASE}/signup`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ username, password }),\n    });\n    if (!res.ok) throw new Error(\"Signup failed\");\n    return await res.json();\n  };\n\n  const logout = () => {\n    setAccessToken(null);\n    setUser(null);\n  };\n\n  const authFetch = async (url, options = {}, retry = true) => {\n    const headers = new Headers(options.headers || {});\n    if (accessToken) headers.set(\"Authorization\", `Bearer ${accessToken}`);\n\n    const res = await fetch(url, { ...options, headers, credentials: \"include\" });\n\n    if (res.status === 401 && retry) {\n      try {\n        const newToken = await refresh();\n        headers.set(\"Authorization\", `Bearer ${newToken}`);\n        return await fetch(url, { ...options, headers, credentials: \"include\" });\n      } catch {\n        logout();\n      }\n    }\n    return res;\n  };\n\n  useEffect(() => {\n    refresh().catch(() => {}).finally(() => setLoading(false));\n  }, []);\n\n  return (\n    <AuthContext.Provider value={{ user, login, signup, logout, authFetch, loading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}